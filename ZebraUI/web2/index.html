<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    <link rel="stylesheet" href="/css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="/css/jquery-ui.structure.min.css" type="text/css">
    <link rel="stylesheet" href="/css/jquery-ui.theme.min.css" type="text/css">
    <link rel="stylesheet" href="/semantic/dist/semantic.min.css" type="text/css">
    <title>ZebraTester</title>
</head>
<body>
   <div class="ui fluid container">
      <div class="ui hidden divider"></div>
       <div class="ui massive attached tabular menu">
           <div class="divider"></div>
             <div id="myLogo" class="ui middle aligned spaced large image">
              <img src="img/chameleonlogo.png">
            </div>
            <div id="statusNotifier" class="ui positive hidden message">
              <p></p>
            </div>
            <div class="right menu">
                <a class="active item" data-tab="build" data-vivaldi-spatnav-clickable="1">Build</a>
                <a class="item" data-tab="run" data-vivaldi-spatnav-clickable="1">Run</a>
                <a class="item" data-tab="analyze" data-vivaldi-spatnav-clickable="1">Analyze</a>
                <a class="item" data-tab="empty" data-vivaldi-spatnav-clickable="1"></a>
            </div>
       </div>
       <div class="ui bottom attached active tab segment" data-tab="build">
            <div class="ui menu">
                <div id="menuFileDropdown" class="ui dropdown link item">
                    <i class="list icon"></i>
                    <span class="text">Menu</span>
                    <div class="menu">
                        <div class="header">File</div>
                        <div id="newScriptButton" class="item"><span class="text">New script...</span></div>
                        <div id="openScriptButton" class="item">Open...</div>
                        <div id="saveScriptButton" class="item"><span class="text">Save</span></div>
                        <div id="saveAsScriptButton" class="item">Save as...</div>
                        <div id="saveAsToolbar" class="ui popup fluid wide"></div>
                        <div class="divider"></div>
                        <div class="header">Load Test</div>
                        <div class="item">Quick Test</div>
                        <div id="generateLoadTest" class="item">Generate Load Test</div>
                    </div>
                </div>
                <div id="menuViewDropdown" class="ui dropdown link item">
                    <i class="book icon"></i>
                    <span class="text">View</span>
                    <div class="menu">
                        <div class="header">Panels</div>
                        <div id='toggleVarHandler' class="item"><span class="text">Toggle Var Handler</span></div>
                        <div id='toggleRecorder' class="item">Toggle Recorder</div>
                        <div class="item">Toggle Project Navigator</div>
                        <div class="divider"></div>
                        <div class="header">Display</div>
                        <div class="item">Original Item Numbers</div>
                        <div class="item">Current Item Numbers</div>
                        <div class="item">Runtime Configuration</div>
                        <div class="item">Item Offset</div>
                        <div class="item">Content Type</div>
                        <div class="item">Content Verification</div>
                    </div>
                </div>
                <div id="menuFilterDropdown" class="ui dropdown link item">
                    <i class="filter icon"></i>
                    <span class="text">Filter items</span>
                    <div class="menu">
                        <div class="header">Sort by</div>
                        <div class="item">Host</div>
                        <div class="item">Content Type</div>
                        <div class="item">Status Code</div>
                        <div class="divider"></div>
                        <div class="header">Exclude</div>
                        <div class="item">Static Content</div>
                        <div class="item">Cached Content</div>
                        <div class="divider"></div>
                        <div class="item">Clear Filter</div>
                    </div>
                </div>
                <div id="popupAnchor" class="ui hidden divider">
                </div>
                <div id="saveToolbar" class="ui popup fluid wide">
                            <h5 class="ui header">Save Dialog</h5>
                            <div class="ui input">
                                <input id="saveInput" type="text" placeholder="Add PageBreak...">
                            </div>
                            <div id="savePrxDat" class="link item">
                                Save
                            </div>
                </div>
                <div class="right menu">
                   <div id="recorderTrigger" class="link item">Recorder</div>
                   <div id="recorderToolbar" class="ui popup fluid wide">
                    <div class="ui menu">
                     <div id="record" class="link item">
                         Start Recording
                    </div>
                    <div id="pageBreaker" class="item">
                         <div class="ui input">
                            <input id="pageBreakerInput" type="text" placeholder="Add PageBreak...">
                          </div>
                    </div>
                    <div id="clearRecord" class="link item">
                         Clear Recording
                    </div>
                    </div>
                    </div>
                    <div class="item">
                         <div class="ui icon input">
                            <input type="text" placeholder="Search...">
                            <i class="search link icon"></i>
                          </div>
                    </div>
                </div>
            </div>
            <div id="listView" class="segment pushable">
                <div class="pusher">
                    <div id="metaDataView" class="ui basic segment">
                    </div>
                    <div id="pageBreakSegments" class="ui segments">
                    </div>
                </div>
                <div id="saveDialog" class="ui inverted labeled icon left inline vertical sidebar menu">
                    <div id="saveDialogChild" class="container">
                    <h5 id="saveAsLabel" class="ui header">Save As...</h5>
                    <div class="item"><div class="ui input">
                        <input id="savePrxDatInput" type="text" placeholder="Enter script name...">
                    </div>
                    </div>
                    <div id="savePrxDatAs" class="link item">
                        Save
                    </div>
                    </div>

            </div>

           </div>
   </div>
   <div class="ui bottom attached tab segment" data-tab="run">
          <div id="loadtestsettingspane" class="ui segment">  
                <div class="ui fluid accordion">
                    <div class="active title"><h3>Settings</h3></div>  
                        <div class="active content">
                           <form class="ui form">
                            <div class="six fields">
                               <div class="field">
                                <label>Number of users</label>
                                <select id="numUsersSelect" class="ui fluid dropdown">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                    <option value="32">32</option>
                                    <option value="33">33</option>
                                    <option value="34">34</option>
                                    <option value="35">35</option>
                                    <option value="36">36</option>
                                    <option value="37">37</option>
                                    <option value="38">38</option>
                                    <option value="39">39</option>
                                    <option value="40">40</option>
                                    <option value="41">41</option>
                                    <option value="42">42</option>
                                    <option value="43">43</option>
                                    <option value="44">44</option>
                                    <option value="45">45</option>
                                    <option value="46">46</option>
                                    <option value="47">47</option>
                                    <option value="48">48</option>
                                    <option value="49">49</option>
                                    <option value="50">50</option>
                                    <option value="51">51</option>
                                    <option value="52">52</option>
                                    <option value="53">53</option>
                                    <option value="54">54</option>
                                    <option value="55">55</option>
                                    <option value="56">56</option>
                                    <option value="57">57</option>
                                    <option value="58">58</option>
                                    <option value="59">59</option>
                                    <option value="60">60</option>
                                    <option value="61">61</option>
                                    <option value="62">62</option>
                                    <option value="63">63</option>
                                    <option value="64">64</option>
                                    <option value="65">65</option>
                                    <option value="66">66</option>
                                    <option value="67">67</option>
                                    <option value="68">68</option>
                                    <option value="69">69</option>
                                    <option value="70">70</option>
                                    <option value="71">71</option>
                                    <option value="72">72</option>
                                    <option value="73">73</option>
                                    <option value="74">74</option>
                                    <option value="75">75</option>
                                    <option value="76">76</option>
                                    <option value="77">77</option>
                                    <option value="78">78</option>
                                    <option value="79">79</option>
                                    <option value="80">80</option>
                                    <option value="81">81</option>
                                    <option value="82">82</option>
                                    <option value="83">83</option>
                                    <option value="84">84</option>
                                    <option value="85">85</option>
                                    <option value="86">86</option>
                                    <option value="87">87</option>
                                    <option value="88">88</option>
                                    <option value="89">89</option>
                                    <option value="90">90</option>
                                    <option value="91">91</option>
                                    <option value="92">92</option>
                                    <option value="93">93</option>
                                    <option value="94">94</option>
                                    <option value="95">95</option>
                                    <option value="96">96</option>
                                    <option value="97">97</option>
                                    <option value="98">98</option>
                                    <option value="99">99</option>
                                    <option value="100">100</option>
                                </select>
                                </div>
                                <div class="field">
                                <label>Load test duration</label>
                                <select id="durationSelect" class="ui fluid dropdown">
                                    <option value="1">1 second</option>
                                    <option value="2">2 seconds</option>
                                    <option value="3">3 seconds</option>
                                    <option value="4">4 seconds</option>
                                    <option value="5">5 seconds</option>
                                    <option value="6">6 seconds</option>
                                    <option value="7">7 seconds</option>
                                    <option value="8">8 seconds</option>
                                    <option value="9">9 seconds</option>
                                    <option value="10">10 seconds</option>
                                    <option value="20">20 seconds</option>
                                    <option value="30">30 seconds</option>
                                    <option value="40">40 seconds</option>
                                    <option value="50">50 seconds</option>
                                    <option value="60">1 minute</option>
                                    <option value="120">2 minutes</option>
                                    <option value="180">3 minutes</option>
                                    <option value="240">4 minutes</option>
                                    <option value="300">5 minutes</option>
                                    <option value="360">6 minutes</option>
                                    <option value="420">7 minutes</option>
                                    <option value="480">8 minutes</option>
                                    <option value="540">9 minutes</option>
                                    <option value="600">10 minutes</option>
                                    <option value="1200">20 minutes</option>
                                    <option value="1800">30 minutes</option>
                                    <option value="2400">40 minutes</option>
                                    <option value="3000">50 minutes</option>
                                    <option value="3600">1 hour</option>
                                    <option value="7200">2 hours</option>
                                    <option value="10800">3 hours</option>
                                    <option value="14400">4 hours</option>
                                </select>
                                  </div>
                              <div class="field">
                                <label>Max iterations per user</label>
                                <select name="" id="iterationsPerUserSelect" class="ui fluid dropdown">
                                    <option value="0">Unlimited</option>
                                    <option value="1">1 iteration</option>
                                    <option value="2">2 iterations</option>
                                    <option value="3">3 iterations</option>
                                    <option value="4">4 iterations</option>
                                    <option value="5">5 iterations</option>
                                    <option value="6">6 iterations</option>
                                    <option value="7">7 iterations</option>
                                    <option value="8">8 iterations</option>
                                    <option value="9">9 iterations</option>
                                    <option value="10">10 iterations</option>
                                    <option value="11">11 iterations</option>
                                    <option value="12">12 iterations</option>
                                    <option value="13">13 iterations</option>
                                    <option value="14">14 iterations</option>
                                    <option value="15">15 iterations</option>
                                    <option value="16">16 iterations</option>
                                    <option value="17">17 iterations</option>
                                    <option value="18">18 iterations</option>
                                    <option value="19">19 iterations</option>
                                    <option value="20">20 iterations</option>
                                    <option value="21">21 iterations</option>
                                    <option value="22">22 iterations</option>
                                    <option value="23">23 iterations</option>
                                    <option value="24">24 iterations</option>
                                    <option value="25">25 iterations</option>
                                    <option value="26">26 iterations</option>
                                    <option value="27">27 iterations</option>
                                    <option value="28">28 iterations</option>
                                    <option value="29">29 iterations</option>
                                    <option value="30">30 iterations</option>
                                    <option value="31">31 iterations</option>
                                    <option value="32">32 iterations</option>
                                    <option value="33">33 iterations</option>
                                    <option value="34">34 iterations</option>
                                    <option value="35">35 iterations</option>
                                    <option value="36">36 iterations</option>
                                    <option value="37">37 iterations</option>
                                    <option value="38">38 iterations</option>
                                    <option value="39">39 iterations</option>
                                    <option value="40">40 iterations</option>
                                    <option value="41">41 iterations</option>
                                    <option value="42">42 iterations</option>
                                    <option value="43">43 iterations</option>
                                    <option value="44">44 iterations</option>
                                    <option value="45">45 iterations</option>
                                    <option value="46">46 iterations</option>
                                    <option value="47">47 iterations</option>
                                    <option value="48">48 iterations</option>
                                    <option value="49">49 iterations</option>
                                    <option value="50">50 iterations</option>
                                    <option value="51">51 iterations</option>
                                    <option value="52">52 iterations</option>
                                    <option value="53">53 iterations</option>
                                    <option value="54">54 iterations</option>
                                    <option value="55">55 iterations</option>
                                    <option value="56">56 iterations</option>
                                    <option value="57">57 iterations</option>
                                    <option value="58">58 iterations</option>
                                    <option value="59">59 iterations</option>
                                    <option value="60">60 iterations</option>
                                    <option value="61">61 iterations</option>
                                    <option value="62">62 iterations</option>
                                    <option value="63">63 iterations</option>
                                    <option value="64">64 iterations</option>
                                    <option value="65">65 iterations</option>
                                    <option value="66">66 iterations</option>
                                    <option value="67">67 iterations</option>
                                    <option value="68">68 iterations</option>
                                    <option value="69">69 iterations</option>
                                    <option value="70">70 iterations</option>
                                    <option value="71">71 iterations</option>
                                    <option value="72">72 iterations</option>
                                    <option value="73">73 iterations</option>
                                    <option value="74">74 iterations</option>
                                    <option value="75">75 iterations</option>
                                    <option value="76">76 iterations</option>
                                    <option value="77">77 iterations</option>
                                    <option value="78">78 iterations</option>
                                    <option value="79">79 iterations</option>
                                    <option value="80">80 iterations</option>
                                    <option value="81">81 iterations</option>
                                    <option value="82">82 iterations</option>
                                    <option value="83">83 iterations</option>
                                    <option value="84">84 iterations</option>
                                    <option value="85">85 iterations</option>
                                    <option value="86">86 iterations</option>
                                    <option value="87">87 iterations</option>
                                    <option value="88">88 iterations</option>
                                    <option value="89">89 iterations</option>
                                    <option value="90">90 iterations</option>
                                    <option value="91">91 iterations</option>
                                    <option value="92">92 iterations</option>
                                    <option value="93">93 iterations</option>
                                    <option value="94">94 iterations</option>
                                    <option value="95">95 iterations</option>
                                    <option value="96">96 iterations</option>
                                    <option value="97">97 iterations</option>
                                    <option value="98">98 iterations</option>
                                    <option value="99">99 iterations</option>
                                    <option value="100">100 iterations</option>
                                    <option value="101">101 iterations</option>
                                    <option value="102">102 iterations</option>
                                    <option value="103">103 iterations</option>
                                    <option value="104">104 iterations</option>
                                    <option value="105">105 iterations</option>
                                    <option value="106">106 iterations</option>
                                    <option value="107">107 iterations</option>
                                    <option value="108">108 iterations</option>
                                    <option value="109">109 iterations</option>
                                    <option value="110">110 iterations</option>
                                    <option value="111">111 iterations</option>
                                    <option value="112">112 iterations</option>
                                    <option value="113">113 iterations</option>
                                    <option value="114">114 iterations</option>
                                    <option value="115">115 iterations</option>
                                    <option value="116">116 iterations</option>
                                    <option value="117">117 iterations</option>
                                    <option value="118">118 iterations</option>
                                    <option value="119">119 iterations</option>
                                    <option value="120">120 iterations</option>
                                    <option value="121">121 iterations</option>
                                    <option value="122">122 iterations</option>
                                    <option value="123">123 iterations</option>
                                    <option value="124">124 iterations</option>
                                    <option value="125">125 iterations</option>
                                    <option value="126">126 iterations</option>
                                    <option value="127">127 iterations</option>
                                    <option value="128">128 iterations</option>
                                    <option value="129">129 iterations</option>
                                    <option value="130">130 iterations</option>
                                    <option value="131">131 iterations</option>
                                    <option value="132">132 iterations</option>
                                    <option value="133">133 iterations</option>
                                    <option value="134">134 iterations</option>
                                    <option value="135">135 iterations</option>
                                    <option value="136">136 iterations</option>
                                    <option value="137">137 iterations</option>
                                    <option value="138">138 iterations</option>
                                    <option value="139">139 iterations</option>
                                    <option value="140">140 iterations</option>
                                    <option value="141">141 iterations</option>
                                    <option value="142">142 iterations</option>
                                    <option value="143">143 iterations</option>
                                    <option value="144">144 iterations</option>
                                    <option value="145">145 iterations</option>
                                    <option value="146">146 iterations</option>
                                    <option value="147">147 iterations</option>
                                    <option value="148">148 iterations</option>
                                    <option value="149">149 iterations</option>
                                    <option value="150">150 iterations</option>
                                    <option value="151">151 iterations</option>
                                    <option value="152">152 iterations</option>
                                    <option value="153">153 iterations</option>
                                    <option value="154">154 iterations</option>
                                    <option value="155">155 iterations</option>
                                    <option value="156">156 iterations</option>
                                    <option value="157">157 iterations</option>
                                    <option value="158">158 iterations</option>
                                    <option value="159">159 iterations</option>
                                    <option value="160">160 iterations</option>
                                    <option value="161">161 iterations</option>
                                    <option value="162">162 iterations</option>
                                    <option value="163">163 iterations</option>
                                    <option value="164">164 iterations</option>
                                    <option value="165">165 iterations</option>
                                    <option value="166">166 iterations</option>
                                    <option value="167">167 iterations</option>
                                    <option value="168">168 iterations</option>
                                    <option value="169">169 iterations</option>
                                    <option value="170">170 iterations</option>
                                    <option value="171">171 iterations</option>
                                    <option value="172">172 iterations</option>
                                    <option value="173">173 iterations</option>
                                    <option value="174">174 iterations</option>
                                    <option value="175">175 iterations</option>
                                    <option value="176">176 iterations</option>
                                    <option value="177">177 iterations</option>
                                    <option value="178">178 iterations</option>
                                    <option value="179">179 iterations</option>
                                    <option value="180">180 iterations</option>
                                    <option value="181">181 iterations</option>
                                    <option value="182">182 iterations</option>
                                    <option value="183">183 iterations</option>
                                    <option value="184">184 iterations</option>
                                    <option value="185">185 iterations</option>
                                    <option value="186">186 iterations</option>
                                    <option value="187">187 iterations</option>
                                    <option value="188">188 iterations</option>
                                    <option value="189">189 iterations</option>
                                    <option value="190">190 iterations</option>
                                    <option value="191">191 iterations</option>
                                    <option value="192">192 iterations</option>
                                    <option value="193">193 iterations</option>
                                    <option value="194">194 iterations</option>
                                    <option value="195">195 iterations</option>
                                    <option value="196">196 iterations</option>
                                    <option value="197">197 iterations</option>
                                    <option value="198">198 iterations</option>
                                    <option value="199">199 iterations</option>
                                    <option value="200">200 iterations</option>
                                </select>
                                
                              </div>
                              <div class="field">
                                <label>Additional Options</label>
                                <input type="text" name="addOptions" placeholder="Additional options...">
                              </div>
                              <div class="field">
                                <label>Current script</label>
                                  <select name="selectedLoadTestSelect" id="selectedLoadTestSelect" class="ui fluid dropdown">
                                      
                                  </select>
                              </div>
                              </div>
                              <button id="runLoadTestButton" class="ui olive button">Run</button>
                                </form>
                              </div>
                        </div>
                    </div>
                </div>
                      
                      
                      
                      
        
                        
        <div class="ui bottom attached tab segment" data-tab="analyze">
            Analyze
        </div>
   </div>
    <script src="/js/jquery-3.1.1.min.js" type="application/javascript"></script>
    <script src="/js/jquery-ui.min.js" type="application/javascript"></script>
    <script src="/semantic/dist/semantic.min.js" type="application/javascript"></script>
    <script src="/js/finder.min.js" type="application/javascript"></script>
    <script src="/js/jquery.finder.js" type="application/javascript"></script>
    <script src="/js/keymage.min.js" type="application/javascript"></script>
    <script>
        $(document).ready(function(e) {
            $.ajax({url: "prxMetaData", success: function(result){
                if ("proxyData" in result){
                    $('#metaDataView').html(renderProjectMetaData(result));
                    $('#pageBreakSegments').html(renderList(result));
                    $('.ui.accordion').accordion({
                        duration: 500
                    });
                    var $toggle  = $('.ui.toggle.button');
                    $toggle.state({text: {inactive : 'S',active   : 'P'}});
                    $("div[id^='urlSegments']").sortable({
                        connectWith: "div#urlSegments.ui.segments",
                        placeholder: "ui-state-highlight",
                        handle: ".title"
                    });
                    $("div[id^='pageBreakSegments']").sortable({
                        connectWith: "div#pageBreakSegments.ui.segments",
                        placeholder: "ui-state-highlight",
                        handle: ".title"
                    });
                }

                //Handles sidebar
                $('.ui.sidebar')
                  .sidebar({
                    context: $('#listView'),
                    dimPage: false,
                    delaySetup: false,
                    transition: 'overlay'
                  });
                populateLoadTestList();
                
            }});
            var keymap = {};
            //Method for preventing default browser behavior for command and control + S
            $(document).keydown(function(event){
                keymap[event.keyCode] = event.type == 'keydown';
                if (keymap[83] && (keymap[91] || keymap[17]) ) {
                    event.preventDefault();
                    keymap ={};
                    $.ajax({url: "savePrxDat", success: function(result){
                        if(result.isSaved){
                            console.log("Script saved");
                            statusUpdate("Script saved");
                        }else{
                        $('.ui.sidebar').sidebar('show');
                        }
                        }});
                }
            });
            
            /*keymage('defmod-s', function() { 
            
            });*/
            
            
            $.fn.toggleClick = function(){
                var methods = arguments, // store the passed arguments for future reference
                    count = methods.length; // cache the number of methods

                //use return this to maintain jQuery chainability
                return this.each(function(i, item){
                    // for each element you bind to
                    var index = 0; // create a local counter for that element
                    $(item).click(function(){ // bind a click handler to that element
                        return methods[index++ % count].apply(this,arguments); // that when called will apply the 'index'th method to that element
                        // the index % count means that we constrain our iterator between 0 and (count-1)
                    });
                });
            }

            //Runs the load test job with the selected settings
            $("#runLoadTestButton").click(function(event){
                event.preventDefault();
                var numUsers= $("#numUsersSelect").val();
                var iterationsPerUser= $("#iterationsPerUserSelect").val();
                var duration= $("#durationSelect").val();
                var selectedTest= $("#selectedLoadTestSelect").val();
                
                console.log("runTest/"+selectedTest+"/"+numUsers+"/"+iterationsPerUser+"/"+duration);
                
                $.ajax({url:"runTest/"+selectedTest+"/"+numUsers+"/"+iterationsPerUser+"/"+duration, success:function(result){
                    console.log("Running test");
                }});
                
                
            });
            
            //Trigger for saving script with specific name
            $("#saveAsScriptButton").click(function() {
                $('.ui.sidebar').sidebar('show');
            });
            
            //Gets a list of all class files in directory
            function populateLoadTestList(){
                $.ajax({url:"listclassfiles", success: function(result){
                    var select = $("#selectedLoadTestSelect");
                    
                    $.each(result, function(){
                       select.append($("<option />").val(this).text(this)); 
                    });
                }});
                
                
            }
            //Save the script with a specific name
            $('#savePrxDatAs').click(function() {
                var saveAsName = $('#savePrxDatInput').val();
                console.log(saveAsName);
                if (saveAsName.length>0){
                    $.ajax({url: 'savePrxDat/'+saveAsName , success: function(result){
                        console.log('Script '+saveAsName+'.prxdat saved correctly');
                        statusUpdate('Script '+saveAsName+'.prxdat saved correctly');
                    }});
                    $('.ui.sidebar').sidebar('hide');
                }
            });

            //Open new script
            $("#openScriptButton").click(function (){
              var input = $(document.createElement('input'));
              input.attr("type", "file");
              input.trigger('click');
              input.on("change",function() {
                console.log("Change triggered");
                var filename=input.val().split("\\fakepath\\")[1];
                $.ajax({url:"openScript/"+filename, success:function(result){
                  console.log("Open script triggered");
                  statusUpdate("Script "+filename+" was opened");
                  refreshHttpList();
                }});
          		});
            });

            //Generate the script
            $("#generateLoadTest").click(function(){
              $.ajax({url:"generateLoadTest", success: function(result){
                console.log("Load test generated");
                statusUpdate("Load test generated");
                populateLoadTestList();
              }});
            });

            //Save the script
            $( "#saveScriptButton" ).click(function() {
            $.ajax({url: "savePrxDat", success: function(result){
                  if(result.isSaved){
                      console.log("Script saved");
                      statusUpdate("Script saved");
                  }else{
                      $('.ui.sidebar').sidebar('show');
                  }
              }});
            });
            //Gives status update
            function statusUpdate (message){
              $("#statusNotifier > p").text(message);
              $("#statusNotifier").removeClass("hidden");
              $("#statusNotifier").show();
              $("#statusNotifier").delay(1000).fadeOut(3000);
            }

            //Clears the entire list
            function clearHTTPList () {
              $('#metaDataView').empty();
              $('#pageBreakSegments').empty();
            }

            //Refreshes the entire list again - usable after a change has been made on the java side
            function refreshHttpList (){
                $.ajax({url: "prxMetaData", success: function(result){
                if (typeof result.proxyData !== 'undefined' && result.proxyData !== null){
                    $('#metaDataView').html(renderProjectMetaData(result));
                    $('#pageBreakSegments').html(renderList(result));
                    $('.ui.accordion').accordion({
                        duration: 500
                    });
                    var $toggle  = $('.ui.toggle.button');
                    $toggle.state({text: {inactive : 'S',active   : 'P'}});
                    $("div[id^='urlSegments']").sortable({
                        connectWith: "div#urlSegments.ui.segments",
                        placeholder: "ui-state-highlight",
                        handle: ".title"
                    });
                    $("div[id^='pageBreakSegments']").sortable({
                        connectWith: "div#pageBreakSegments.ui.segments",
                        placeholder: "ui-state-highlight",
                        handle: ".title"
                    });
                }
                //Handles sidebar
                $('.ui.sidebar')
                  .sidebar({
                    context: $('#listView'),
                    dimPage: false,
                    delaySetup: false,
                    closable: false,
                    transition: 'overlay'
                  });

                }});}

            //Handles toggling of the recorder
            $('#record').toggleClick(function(){
                $(this).addClass('recording');
                $(this).text('Stop Recording');
                $.ajax({url:'startRecording', success: function(result){
                    statusUpdate("Recording started successfully");
                    console.log("Recording started successfully");
                }});
            },function(){
                $(this).removeClass('recording');
                $(this).text('Start Recording');
                $.ajax({url:'stopRecording', success: function(result){
                    refreshHttpList();
                    statusUpdate("Recording stopped successfully");
                    console.log("Recording stopped successfully");
                }});
            });

            //Clears recording
            $('#clearRecord').click(function(){
                $.ajax({url:'clearRecording', success: function(result){
                    statusUpdate("Recording cleared successfully");
                    console.log("Recording cleared successfully");
                    clearHTTPList();
                }});
            });

            //Adds page breaks via the recorder
            $('#pageBreakerInput').keypress(function (e) {
                  if (e.which == 13) {
                    $.ajax({url:'addPageBreakRec/'+$('#pageBreakerInput').val(), success: function(result){
                        console.log('Page Break '+$('#pageBreakerInput').val()+' created successfully');
                        statusUpdate('Page Break '+$('#pageBreakerInput').val()+' created successfully');
                        refreshHttpList();
                    }});
                    return false;
                  }
                });

            //Trigger for the recorder popup
            $('#recorderTrigger')
              .popup({
                popup : $('#recorderToolbar'),
                on    : 'click',
                position : 'bottom right'
              });

            $('#saveScriptButton')
              .popup({
                popup : $('#saveToolbar'),
                on    : 'click',
                target: '#popupAnchor',
                position : 'bottom left'
              });

            $('.right.menu .item').tab();
            $('#menuFileDropdown').dropdown({action: 'select'});
            $('#menuViewDropdown').dropdown({action: 'select'});
            $('#menuFilterDropdown').dropdown({action: 'select'});
            $('select.dropdown').dropdown();
            

            //Render the metaData of the Project
            function renderProjectMetaData(result){
                var output;

                output='<div class="ui grid">'+
                    '<div class="ten wide column"><h3 id="projectNameLabel" class="ui left aligned header">'+result.projectName+
                    '<div class="sub header">Script Name</div></h3></div>'+
                    '<div class="two wide column"><h3 id="projectURLCount" class="ui center aligned header">'+
                    countURLCalls(result)+
                    '<div class="sub header">Number of<br>URL calls</div></h3></div>'+
                    '<div class="two wide column"><h3 id="projectSentSize" class="ui center aligned header">'+
                    calculateTotalRequestSize(result)+
                    '<div class="sub header">Total Size<br> Sent</div></h3></div>'+
                    '<div class="two wide column"><h3 id="projectRecievedSize" class="ui center aligned header">'+
                    calculateTotalResponseSize(result)+
                    '<div class="sub header">Total Size<br> Recieved</div></h3></div>'+
                    '</div>'

                return output;
            }

            //Counts number of URL calls
            function countURLCalls(result){
                var count=0;

                for(var i = 0; i<result.proxyData.length; ++i){
                    var record=result.proxyData[i];
                    if ("httpRequest" in record){
                        count=count+1;
                    }

                }

                return count;
            }


            //Selects the correct label for content type
            function pickContentLabel (contentType){
                var label;
                if(typeof contentType === 'undefined'){
                   label='<div id="contentTypeLabel" class="ui medium black label">N/A</div>';
                }else if (contentType.includes('TEXT/HTML')){
                    label='<div id="contentTypeLabel" class="ui medium blue label">HTML</div>';
                }else if (contentType.includes('TEXT/CSS')){
                    label='<div id="contentTypeLabel" class="ui medium red label">CSS</div>';
                }else if (contentType.includes('APPLICATION/X-JAVASCRIPT')|| contentType.includes('APPLICATION/JAVASCRIPT')){
                    label='<div id="contentTypeLabel" class="ui medium olive label">JS</div>';
                }else if (contentType.includes('APPLICATION/JSON')){
                    label='<div id="contentTypeLabel" class="ui medium green label">JSON</div>';
                }else if (contentType.includes('IMAGE')){
                    label='<div id="contentTypeLabel" class="ui medium orange label">IMAGE</div>';
                }else{
                    label='<div id="contentTypeLabel" class="ui medium grey label">OTHER</div>';
                }
                return label;
            }

            //Chooses the correct HTTP Response code
            function pickStatusCode(statusCode, statusMessage){
                var statusLabel = '<b>'+statusCode+' '+statusMessage+'</b>';
                return statusLabel;
            }

            //Renders the list of URL calls and page breaks
            function renderList (data){
                var html='';
                var dataArray = data.proxyData;

                for (var i = 0; i < dataArray.length;++i){
                    var proxyRecord = dataArray[i];

                    if ('httpPageBreak' in proxyRecord){
                        if (i>0){
                            html += '</div></div></div></div>';
                        }
                        html += '<div id="pageBreakSegment'+i+'" pageBreakID="'+ i +
                            '" class="ui segment">'+'<div class="ui fluid accordion">'+
                        '<div class="title">'+proxyRecord.httpPageBreak.comment+'</div>'+
                        '<div class="content"><div id="urlSegments" class="ui segments">';
                    }
                    else{
                        html += '<div id="urlSegment"urlID="'+i+'" class="ui segment">'+
                            '<div class="item"><button id="serialParallelButton" class="ui tiny right floated toggle button">S</button></div>'+
                            '<div class="item" id="urlSizeText"><b>'+calculatePageSize(proxyRecord.httpResponse.headerContentLength)+'</b></div>'+
                            '<div class="accordion" urlIDAccordion="'+i+'">'+
                            '<div class="title">'+
                            pickContentLabel(proxyRecord.httpResponse.headerContentType)+
                            pickStatusCode(proxyRecord.httpResponse.headerServerStatus, proxyRecord.httpResponse.headerServerStatusText)+
                            ' '+
                            proxyRecord.httpRequest.urlProtocol+
                            '://'+proxyRecord.httpRequest.urlHost+proxyRecord.httpRequest.urlFile+'</div>'+'<div class="content">'+
                            renderURLCall(proxyRecord, i)+
                            '</div>'+
                            '</div></div>';


                    }

                }
                html += '</div></div></div></div>';
                return html;
            }

            //Calculates the totalResponseSize
            function calculateTotalResponseSize(result){
                var contentSize=0;

                for (var i = 0; i<result.proxyData.length; ++i){
                    var record = result.proxyData[i];
                    if ("httpResponse" in record){
                        contentSize=contentSize+record.httpResponse
                            .headerContentLength;
                    }
                }

                return calculatePageSize(contentSize);
            }

            //Calculates the totalRequestSize
            function calculateTotalRequestSize(result){
                var contentSize=0;

                for (var i = 0; i<result.proxyData.length; ++i){
                    var record = result.proxyData[i];
                    if ("httpRequest" in record){
                        contentSize=contentSize+record.httpRequest
                            .requestTransmitSize;
                    }
                }

                return calculatePageSize(contentSize);
            }

            //Calculates the response content size
            function calculatePageSize(headerContentLength){

                var sizeB=headerContentLength;
                var sizeKB = headerContentLength/1024;
                var sizeMB = sizeKB/1024;

                if (sizeKB>1024){
                    return Math.round(sizeMB * 10)/10 + ' MB';
                }else if(sizeKB<1){
                    return Math.round(sizeB * 10)/10 + ' B';
                }else{
                    return Math.round(sizeKB * 10)/10 + ' KB';
                }
            }

            //Renders individual data for URL call
            function renderURLCall (urlCall, index){
                var output='';

                output+='<div class="ui two column grid">'+
                    '<div class="row">'+
                    '<div class="column">'+
                    '<div id="urlSegmentGroup" class="ui segments">'+
                    '<div id="requestHeaderHead" class="ui attached yellow inverted segment">'+
                    '<div class="ui medium header">Request Header</div></div>'+
                    renderRequestHeaders(urlCall.httpRequest.header)+'</div></div>'+
                    renderRequestContent(urlCall.httpRequest)+
                    '</div>'+
                    '<div class="row">'+
                    '<div class="column">'+
                    '<div id="urlSegmentGroup" class="ui segments">'+
                    '<div id="responseHeaderHead" class="ui attached black inverted segment">'+
                    '<div class="ui medium header">Response Header</div></div>'+
                    renderResponseHeaders(urlCall.httpResponse.header)+'</div></div>'+
                    '<div class="column">'+
                    renderResponseContent(urlCall.httpResponse)+
                    '</div></div></div>';

                return output;
            }

            //Renders the individual response headers for a URL call
            function renderResponseHeaders(urlCall){
                var output = '';
                output += '<div id="headerSegment" class="ui attached segment">'+
                            '<b>'+urlCall[0]+'</b></div>';

                for (var i = 1; i<urlCall.length;++i){
                    if(typeof urlCall[i] !== 'undefined'){
                        var headerSplit = urlCall[i].split(": ");
                        output += '<div id="headerSegment" class="ui attached segment">'+
                            '<b>'+headerSplit[0]+': </b>'+headerSplit[1]+'</div>';
                    }

                }

                return output;
            }

            //Renders the individual request headers for a URL call
            function renderRequestHeaders(urlCall){
                var output = '';

                for (var i = 0; i<urlCall.length;++i){
                    if(typeof urlCall[i] !== 'undefined'){
                        var headerSplit = urlCall[i].split(": ");
                        output += '<div id="headerSegment" class="ui attached segment">'+
                            '<b>'+headerSplit[0]+': </b>'+headerSplit[1]+'</div>';
                    }

                }

                return output;
            }
            //Render the appropriate response according to the content type
            function renderContent(urlCall){
                var output = '';
                var contentType = urlCall.headerContentType


                if(typeof(contentType) == 'undefined'){
                    output='';
                }else if (contentType.includes("FONT-WOFF")){
                    output='';
                }else if (contentType.includes('IMAGE')){
                    output='<img src="data:'+contentType.toLowerCase()+';base64,'+urlCall.content+'">';
                }else{
                    output=urlCall.content;
                }
                return output;
            }

            //Renders the responseContent
            function renderResponseContent(urlCall){
                var output='';

                if("content" in urlCall && urlCall.content.length>0){
                    output+='<div id="urlSegmentGroup" class="ui segments">'+
                    '<div id="requestContentHead" class="ui black inverted attached segment">'+
                    '<div class="ui medium header">Response Content</div>'+
                    '</div><div id="responseContentSegment" class="ui attached segment">'+
                        renderContent(urlCall)+
                        '</div></div>';
                }
                else{
                    output+='';
                }
                return output;
            }

            //Renders the requestContent
            function renderRequestContent(urlCall){
                var output='';

                if("content" in urlCall){
                    output+='<div class="column"><div id="urlSegmentGroup" class="ui segments">'+
                    '<div id="requestContentHead" class="ui yellow inverted attached segment">'+
                    '<div class="ui medium header">Request Content</div>'+
                    '</div><div id="requestContentSegment" class="ui attached segment">'+
                        byteToString(urlCall.content)+
                        '</div>'+'</div></div>';
                }
                else{
                    output+='';
                }
                return output;
            }

            //Converts bit array to String
            function byteToString(array){
                return String.fromCharCode.apply(null, array);
            }

        });
    </script>
</body>
</html>
